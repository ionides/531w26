
```{python}
#| label: q7_01_read_data_for_lead_lag_question
#| echo: false
#| fig-width: 7
#| fig-height: 2.5
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import statsmodels.api as sm
from statsmodels.tsa.stattools import ccf

# Read and process CPI data
cpi_wide = pd.read_csv("data/consumer_price_index.csv")
cpi_long = cpi_wide.iloc[:, 1:13].values.T.flatten()
inflation = np.diff(np.log(cpi_long))
year = np.arange(1913, 1913 + len(cpi_long)/12, 1/12)[1:]
inflation = inflation[year >= 1980] * 12 * 100  # percent, annualized
year = year[year >= 1980]

# Apply loess smoothing to inflation
lowess = sm.nonparametric.lowess(inflation, year, frac=0.1)
inflation = lowess[:, 1]

# Read and process unemployment data
unemp_wide = pd.read_csv("data/adjusted_unemployment.csv")
unemployment = unemp_wide.iloc[:, 1:13].values.T.flatten()
u_year = np.arange(1948, 1948 + len(unemployment)/12, 1/12)[1:]
unemployment = unemployment[u_year >= 1980]
u_year = u_year[u_year >= 1980]

# Compute cross-correlation
# Python ccf has opposite sign convention from R
lag_max = 80
ccf_values = ccf(inflation, unemployment, nlags=lag_max)
lags = np.arange(-lag_max, lag_max + 1)

# Create two-panel plot
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(7, 2.5))

# Panel A: Time series
ax1.plot(year, inflation, 'k-', linewidth=1, label='inflation')
ax1.plot(u_year, unemployment, 'r-', linewidth=1, label='unemployment')
ax1.set_xlabel('')
ax1.set_ylabel('')
ax1.text(2000, 13, 'A', fontsize=16)

# Panel B: Cross-correlation function
# R's ccf shows negative lags on left, positive on right
# statsmodels ccf returns full correlation including both sides
ax2.stem(lags, np.concatenate([ccf_values[::-1], ccf_values[1:]]),
         linefmt='C0-', markerfmt='C0o', basefmt=' ', use_line_collection=True)
ax2.axhline(y=0, color='k', linewidth=0.5)
# Add confidence bands (approximate)
n = len(inflation)
conf_bound = 1.96 / np.sqrt(n)
ax2.axhline(y=conf_bound, color='b', linestyle='--', linewidth=0.5)
ax2.axhline(y=-conf_bound, color='b', linestyle='--', linewidth=0.5)
ax2.set_xlabel('lag (months)')
ax2.set_ylabel('CCF')
ax2.text(0, 0.32, 'B', fontsize=16)

plt.tight_layout()
plt.show()
```

\(A) Inflation (black) and unemployment (red) for the USA, 1980-2024. (B) Cross-correlation function, `ccf(inflation,unemployment)`. What is the best interpretation of this plot?

A: High inflation generally led high unemployment, with a lag of about 4 yr.\
B: High inflation generally followed high unemployment, with a lag of about 4 yr.\
C: Association is not causation, so we should not interpret a cross-correlation plot in terms of lead and lag relationships.



