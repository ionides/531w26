
```{python}
#| label: q4_04_read_mers_for_shapiro_wilks
#| echo: false
#| fig-width: 7
#| fig-height: 2.5
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from scipy import stats
from statsmodels.tsa.arima.model import ARIMA

# Code adapted from
# https://ionides.github.io/531w24/final_project/project15
mers_df = pd.read_csv("data/mers.csv", comment='#')
saudi = mers_df[mers_df['Region'] == 'Saudi Arabia']
mers = saudi['New Cases'].values
year = saudi['Year'].values + (saudi['Week'].values - 1) / 52
mask = year > 2013.5
mers = mers[mask]
year = year[mask]

# Fit ARMA(2,2)
arma22 = ARIMA(mers, order=(2, 0, 2)).fit()

# Create two-panel plot
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(7, 2.5))

# Panel A: Time series
ax1.plot(year, mers, 'k-', linewidth=1)
ax1.set_xlabel('Year')
ax1.set_ylabel('MERS Reports')
ax1.text(2016, 80, 'A', fontsize=16)

# Panel B: Q-Q plot
stats.probplot(arma22.resid, dist="norm", plot=ax2)
ax2.set_title('')
ax2.text(0, 35, 'B', fontsize=16)

plt.tight_layout()
plt.show()
```

\(A) Weekly cases of Middle East Respiratory Syndome (MERS) in Saudi Arabia. (B) a normal quantile residual plot for ARMA(2,2). We can formally test for non-normality of these residuals by a Shapiro-Wilk test (p-value=$4.8\times 10^{-21}$). What best describes the value added by presenting the Shapiro-Wilk test here?

```{python}
#| label: q4_04_mers_shapiro_wilk
#| echo: false
#| output: false
# Compute Shapiro-Wilk test
_, p_value = stats.shapiro(arma22.resid)
print(f"{p_value:.2e}")
```

**A.** We should always be alert for the danger of seeing patterns in noise. The Shapiro-Wilk test is useful to confirm our assessment that the normal quantile plot shows long tails.\
**B.** Presenting the Shapiro-Wilk test here is not very insightful here, since the long tails are obvious from the normal quantile plot. However, adding this test demonstrates technical competence so it is better to include it than to omit it.\
**C.** The long tails are established from the normal quantile plot. We could consider a log transform, or a long-tailed model, or a bootstrap simulation study to investigate whether the conclusions are sensitive to non-normality. Adding a fairly uninformative test instead of investigating the consequences of the error distribution could be a distraction from good data analysis.\
**D.** The Shapiro-Wilk test is useful, but has the problem that it only tells us about lack of normality, not whether the non-normality is due to skew or kurtosis. We should supplement with a Jarque-Bera test to assess those.




