
```{python}
#| label: q7_01_read_data_for_lead_lag_question
#| echo: false
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import statsmodels.api as sm
from statsmodels.graphics.tsaplots import plot_ccf
from statsmodels.tsa.stattools import ccf

# Read and process CPI data
cpi_wide = pd.read_csv("data/consumer_price_index.csv", comment='#')
cpi_long = cpi_wide.iloc[:, 1:13].values.flatten()
inflation = np.diff(np.log(cpi_long))
year = np.arange(1913, 1913 + len(cpi_long)/12, 1/12)[1:]
inflation = inflation[year >= 1980] * 12 * 100  # percent, annualized
year = year[year >= 1980]

# Apply loess smoothing to inflation
lowess = sm.nonparametric.lowess(inflation, year, frac=0.1)
inflation = lowess[:, 1]

# Read and process unemployment data
unemp_wide = pd.read_csv("data/adjusted_unemployment.csv", comment='#')
unemployment = unemp_wide.iloc[:, 1:13].values.flatten()
u_year = np.arange(1948, 1948 + len(unemployment)/12, 1/12)
mask = u_year >= 1980
unemployment = unemployment[mask]
u_year = u_year[mask]
```

```{python}
#| echo: false
# Create two-panel plot
Lmax=100
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(7, 2.5))

# Panel A: Time series
ax1.plot(year, inflation, 'k-', linewidth=1, label='inflation')
ax1.plot(u_year, unemployment, 'r-', linewidth=1, label='unemployment')
ax1.set_xlabel('')
ax1.set_ylabel('')
ax1.text(0.15, 0.95, 'A', transform=ax1.transAxes, fontsize=16, va='top')

# plt.xcorr(x,y) is mean of x[n+k]y[k]
# so, positive lags correspond to y leading x
ax2.xcorr(inflation-np.mean(inflation), 
  unemployment-np.mean(unemployment), maxlags=Lmax)
ax2.set_title('')
#ax2.set_ylabel('CCF')
ax2.text(0.15, 0.95, 'B', transform=ax2.transAxes, fontsize=16, va='top')
ax2.set_xlim(-Lmax,Lmax)
plt.tight_layout()
plt.show()

```

\(A) Inflation (black) and unemployment (red) for the USA, 1980-2024. (B) Cross-correlation function, `plt.xcorr(inflation,unemployment)`. What is the best interpretation of this plot?

A: High inflation generally led high unemployment, with a lag of about 4 yr.\
B: High inflation generally followed high unemployment, with a lag of about 4 yr.\
C: Association is not causation, so we should not interpret a cross-correlation plot in terms of lead and lag relationships.



