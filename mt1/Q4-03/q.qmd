
```{python}
#| label: q4_03_read_cpi_and_unemp
#| echo: false
#| fig-width: 7
#| fig-height: 2.5
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import statsmodels.api as sm
from statsmodels.graphics.tsaplots import plot_acf

# Read and process CPI data
cpi_wide = pd.read_csv("data/consumer_price_index.csv", comment='#')
cpi_long = cpi_wide.iloc[:, 1:13].values.T.flatten()
inflation = np.diff(np.log(cpi_long))
year = np.arange(1913, 1913 + len(cpi_long)/12, 1/12)[1:]
inflation = inflation[year >= 1980] * 12 * 100  # percent, annualized
year = year[year >= 1980]

# Apply loess smoothing
lowess = sm.nonparametric.lowess(inflation, year, frac=0.1)
inflation = lowess[:, 1]

# Read and process unemployment data
unemp_wide = pd.read_csv("data/adjusted_unemployment.csv", comment='#')
unemployment = unemp_wide.iloc[:, 1:13].values.T.flatten()
u_year = np.arange(1948, 1948 + len(unemployment)/12, 1/12)
mask = u_year >= 1980
unemployment = unemployment[mask]
u_year = u_year[mask]

# OLS regression
X = sm.add_constant(unemployment)
ols = sm.OLS(inflation, X).fit()

# Create two-panel plot
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(7, 2.5))

# Panel A: Time series
ax1.plot(year, inflation, 'k-', linewidth=1)
ax1.plot(u_year, unemployment, 'r-', linewidth=1)
ax1.set_xlabel('')
ax1.set_ylabel('')
ax1.text(1988, 13, 'A', fontsize=16)

# Panel B: ACF of residuals
plot_acf(ols.resid, lags=50, ax=ax2, alpha=0.05)
ax2.set_title('')
ax2.text(12, 0.87, 'B', fontsize=16)

plt.tight_layout()
plt.show()
```

\(A) Inflation (black) and unemployment (red) for the USA, 1980-2024. (B) Sample autocorrelation function of the residuals from a least square regression, 'lm(inflation~unemployment)', with estimated coefficients below. Which is the best interpretation of these graphs and fitted model?

```{python}
#| label: q4_03_lm_inflation_unemployment
#| echo: false
# Print coefficients
print(ols.params)
```

A: 0.05 is a reasonable estimate for the additional unemployment caused by one percentage point of additional inflation. We should not trust the uncertainty estimate (not shown), since our model does not allow for autocorrelation of the residuals.

B: 0.05 is a reasonable estimate for the association between inflation and unemployment. We should not assume there is a causal relationship. We should not trust the uncertainty estimate (not shown), since our model does not allow for autocorrelation of the residuals.

C: 0.05 is a reasonable estimate for the association between inflation and unemployment.  We should make an additional assumption that there are no confounding variables, and then we can interpret this association to be causal. We should not trust the uncertainty estimate (not shown), since our model does not allow for autocorrelation of the residuals.



